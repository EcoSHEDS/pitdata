<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fish Data Visualizations | SHEDS</title>

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/landing-page/css/landing-page.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="libs/leaflet/dist/leaflet.css" rel="stylesheet" type="text/css">

  <style>
    body, h1, h2, h3, h4, h5, h6 {
      font-weight: 400;
      font-family: "Open Sans", Helvetica, Arial, sans-serif !important;
    }

    .top-section {
      background: #222;
      color: white;
    }

    .funding-section img {
      margin: 10px 25px 10px 25px;
    }

    #mapwest {
      height: 225px;
      width: 350px;
      margin: 0 10px;
      display: block;
      margin: auto;
      width: 85%;
    }

    #mapstanley {
      height: 225px;
      width: 350px;
      margin: 0 10px;
      display: block;
      margin: auto;
      width: 85%;
    }

    div.tooltip {
      position: absolute;
      padding: 8px;
      font: 12px sans-serif;
      background: #C6C6C6;
      pointer-events: none;
      height: auto;
      width: 480px;
      text-align: center;
    }

    .object-fit_contain { object-fit: contain }

    img[class] {
      width: 100%;
    }

    h4 {
      font-size: 20px;
    }

    p {
      font-size: 1.2em;
    }

  </style>
</head>
<body>

<div style="border-bottom: 2px solid #e7e7e7;background:#f8f8f8">
  <div class="container">
    <div class="row" style="margin-top: 20px; margin-bottom: 20px">
      <div class="col-xs-12">
        <h1>Fish Tagging Data Visualizations <small>part of the <a href="https://www.ecosheds.org/">Spatial Hydro-Ecological Decision System</a></small></h1>
      </div>
    </div>
  </div>
</div>

<div class="content-section-b top-section">
  <div class="container">
    <div class="row" style="margin-top: 20px; margin-bottom: 40px">
      <div class="col-md-4">
        <h2>What is a Tagging Study?</h2>
        <p>Understanding the performance and fate of individual fish helps us understand why populations fluctuate over time.</p>
        <p>Since 1997, we have studied stream fish using <a href="https://en.wikipedia.org/wiki/Radio-frequency_identification"> tags </a>that contain unique electronic codes. We can estimate body growth, movement, and  reproduction (performance), as well as survival (fate) by recapturing tagged fish over time. </p>
        <p>Our two longest-running tagging studies are the West Brook, in Whately MA and Stanley Brook in Seal Harbor, Maine. Dots on the maps are 20m-long (WB) or 40-m long (SB) sampling sections. Mouse over a section in the West Brook to see a picture of the section from 2006 (WB) or 2008 (SB).</p>
      </div>

      <div class="col-md-8">
        <div class="row">
          <div class="col-md-6 text-center" style="margin-top: 40px">
            <h3>West Brook, MA</h3>
            <div>
              <div id="mapwest"></div>
            </div>
          </div>

          <div class="col-md-6 text-center" style="margin-top: 40px">
            <h3>Stanley Brook, ME</h3>
            <div>
              <div id="mapstanley"></div>
            </div>
          </div>
        </div>

        <div class="row" >
          <div class="col-md-12 text-center" style="margin-top: 20px">
             <p><a class="btn btn-lg btn-primary" style="margin-top: 25px" href="#overview">Begin with the Overview <span class="glyphicon glyphicon-chevron-right"></span></a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="content-section-a">
  <div class="container">
    <div class="row" style="margin-top: 40px" id="overview">
      <div class="col-md-6">
        <h2><a href="/overview">Overview</a></h2>
        <h4>What is the scope of the fish tagging studies?</h4>

        <p>
          The <a href="/overview">overview visualization</a> provides a step-by-step explanation of the basic patterns we found in the fish tagging datasets for each watershed. Through this narrative, you will learn how the number of captured fish varies between species, seasons, river branches, and year to year. At the end, the visualization lets you explore characteristics of the dataset yourself by changing the color and grouping of bubbles representing individual fish.
        </p>
      </div>
      <div class="col-md-6 text-center">
        <a href="/overview">
          <img src="/img/thumb-overview.png" width="500px">
        </a>
      </div>
    </div>
    <div class="row" style="margin-top: 40px" id="crossfilter">
      <div class="col-md-6">
        <h2><a href="/crossfilter">Interactive Crossfilter</a></h2>
        <h4>What are the relationships between variables?</h4>

        <p>
          The <a href="/crossfilter">interactive crossfilter visualization</a> lets you slice and dice the dataset across multiple variables. Each variable is represented by a histogram showing the number of fish captured for each value. You can focus on subsets of the dataset by selecting individual categories or ranges of values among the variables, and then immediately see how the other variables respond through linked changes in the other histograms.
        </p>
      </div>
      <div class="col-md-6 text-center">
        <a href="/crossfilter">
          <img src="/img/thumb-crossfilter.png" width="500px">
        </a>
      </div>
    </div>
    <div class="row" style="margin-top: 40px" id="movements">
      <div class="col-md-6">
        <h2><a href="/fish-movements">Fish Movements</a></h2>
        <h4>How do individual fish move over time and space?</h4>

        <p>
          The <a href="/fish-movements">fish movement visualization</a> shows how individual fish move between sections of the river over time. Watch the fish from West Brook or Stanley Brook move from season to season and see who lives and dies. Individuals, all fish from a sampling section, river or even family (in some years) can be selected to see how groups of fish move around and how long they survive.
        </p>
      </div>
      <div class="col-md-6 text-center">
        <a href="/fish-movements">
          <img src="/img/thumb-movement.png" width="500px">
        </a>
      </div>
    </div>
  </div>
</div>

<div class="content-section-b">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <h2>Project Team</h2>
        <p>Ben Letcher initiated the West Brook study in 1997 with Gabe Gries. Since then the study has been a collaboration among the <a href="http://www.lsc.usgs.gov/?q=cafb-population-dynamics-personnel">USGS Conte Laboratory</a> (Ben Letcher, Matt O'Donnell, Todd Dubreuil), the <a href="http://www.nrs.fs.fed.us/people/knislow">USFS Northern Research Station</a> (Keith Nislow, Jason Coombs), and the <a href="http://eco.umass.edu/">University of Massachusetts Department of Environmental Conservation</a> (<a href="http://www.cfc.umt.edu/personnel/details.php?ID=4461">Andrew Whiteley</a> - now at The University of Montana). </p>
        <p>Ben Letcher and Matt O'Donnell started the Stanley Brook study in 2006 with <a href="http://www.coopunits.org/Maine/People/Joseph_Zydlewski/">Joe Zydlewski </a> from <a href="https://umaine.edu/wle/faculty-staff-directory/">the University of Maine </a> and Bruce Connery of the <a href="https://www.nps.gov/acad/index.htm">National Park Service </a>.</p>
        <p>We thank the many graduate students, interns, post-docs and others who have helped sample the streams over the years. </p>
        <p>The web site and data visualizations were developed by <a href="http://www.lsc.usgs.gov/?q=cafb-ben-letcher">Ben Letcher</a> and <a href="http://walkerenvres.com">Jeff Walker</a>.</p>
      </div>
    </div>
  </div>
</div>


<div class="content-section-a">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <h2>Funding Sources</h2>
        <p><a href="http://www.lsc.usgs.gov/?q=cafb-population-dynamics-personnel">USGS Conte Laboratory</a> and
        <a href="http://www.nrs.fs.fed.us/">USFS Northern Research Station</a>, with additional funding from:

        <div class="row">
          <div class="col-lg-12 text-center funding-section">
            <a href="http://www.nature.org/ourinitiatives/regions/northamerica/areas/connecticutriver/index.htm"><img src="img/logo-tnc.png" alt="TNC Logo"></a>
            <a href="https://necsc.umass.edu/"><img src="img/logo-necsc.png" alt="NECSC Logo"></a>
            <a href="http://northatlanticlcc.org/"><img src="img/logo-nalcc.jpg" alt="NALCC Logo"></a>
            <a href="http://www.usgs.gov"><img src="img/logo-usgs.png" alt="USGS Logo"></a>
            <a href="http://www.doi.gov"><img src="img/logo-doi.png" alt="DOI Logo"></a>
            <a href="http://www.usgs.gov/hurricane/sandy/#overview.html"><img src="img/logo-sandy.png" alt="USGS Sandy Logo"></a>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <p class="copyright text-muted">Copyright Â© 2016 SHEDS Development Team</p>
      </div>
    </div>
  </div>
</footer>



<script src="libs/leaflet/dist/leaflet.js"></script>
<script src="libs/d3/d3.min.js"></script>

<script>

var app = {
  state:  {
    selectedWatershed: 'west'
  }
}

var riverNames = {
  'West Brook': 'WB',
  'WB Mitchell': 'OS',
  'WB Jimmy': 'OL',
  'WB Obear': 'IL',
  'east': 'east',
  'west': 'west',
  'mainstem': 'mainstem',
  'tidal': 'tidal'
};

var featureWest, featureStanley;

// read in data
d3.queue()
  .defer(d3.csv, 'data/coordsForD3JS.csv')
  .await(function (error, coords) {
    if (error) {
      alert('Error occurred while loading the data.');
      throw error;
    }

  app.locations = coords;
  console.log(app)

  app.locations.forEach(function (d) {
    d.lat = +d.lat;
    d.lon = +d.lon;
    d.river = riverNames[d.riverFull];
    d.LatLng = new L.LatLng(d.lat, d.lon)
  });

// map for West ///
  var latLonCenter = [42.434, -72.669],
      zoom = 15

  var locationsWest = app.locations.filter(function(d){return d.watershed == app.state.selectedWatershed})

  var mapWest = L.map('map' + app.state.selectedWatershed).setView(latLonCenter, zoom);

  L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(mapWest);

  mapWest._initPathRoot();


  var year = 2006, season = 1;
  var locationsMap,featureWest;

  var svg = d3.select("#map" + app.state.selectedWatershed).select("svg"),
      g = svg.append("g");

  var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);


    var riverColors = d3.scaleOrdinal(d3.schemeCategory10)
      .domain(['WB', 'OS', 'OL', 'IL']);

    featureWest = g.selectAll("circle")
      .data(locationsWest)
      .enter().append("circle")
      .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
      .style("fill", function(d) { return riverColors(d.river); })
      .style("opacity", 0.6)
      .attr("r", 4)
      .on("mouseover", function(d) {
        d3.select(this)
          .attr("r", 8)
          .style("stroke", "red")
          .style("fill", "lightgrey");

        var fileName = "img/westbrook/" + d.river + "_" + year + "_" + season + "_" + d.section + ".jpg";

        tooltip.html('<h3>River = ' + d.riverFull + ", Section = " + d.section + '</h3><br><img class="object-fit-contain" src= ' + fileName + '>')
           .style("left", "80px")// (d3.event.pageX + 15) + "px")
           .style("top",  "200px")// (d3.event.pageY - 15) + "px")
           .transition()
           .duration(100)
           .style("opacity", 1);
      })
      .on("mouseout", function (d) {
        d3.select(this)
          .attr("r", 4)
          .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
          .style("fill", function(d) { return riverColors(d.river); });

         tooltip.transition()
           .duration(250)
           .style("opacity", 0);
      });

  mapWest.on("viewreset", onViewResetWest)
  onViewResetWest();

  function onViewResetWest() {
    featureWest.attr("transform", function(d) {
      return "translate(" + mapWest.latLngToLayerPoint(d.LatLng).x + "," +
                            mapWest.latLngToLayerPoint(d.LatLng).y + ")";
    });
  }

  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // repeat for Stanley, inefficient, but fast ////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  app.state.selectedWatershed = 'stanley';
  latLonCenter = [44.303, -68.242]
  zoom = 13

  var locationsStanley = app.locations.filter(function(d){return d.watershed == app.state.selectedWatershed})

  var mapStanley = L.map('map' + app.state.selectedWatershed).setView(latLonCenter, zoom);

  L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(mapStanley);

  mapStanley._initPathRoot();


  var year = 2006, season = 1;
  var locationsMap,featureStanley;

  var svg = d3.select("#map" + app.state.selectedWatershed).select("svg"),
      g = svg.append("g");

    var riverColors = d3.scaleOrdinal(d3.schemeCategory10)
      .domain(['WB', 'OS', 'OL', 'IL']);

    featureStanley = g.selectAll("circle")
      .data(locationsStanley)
      .enter().append("circle")
      .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
      .style("fill", function(d) { return riverColors(d.river); })
      .style("opacity", 0.6)
      .attr("r", 4)
      .on("mouseover", function(d) {
        var year = 2008, season = 2;
        var riverLabel = {
          'east': 'SB East',
          'west': 'SB West',
          'mainstem': 'SB Mainstem',
          'tidal': 'SB Tidal'
        }
        d3.select(this)
          .attr("r", 8)
          .style("stroke", "red")
          .style("fill", "lightgrey");

        var fileName = "img/stanley/" + d.river + "_" + year + "_" + season + "_" + d.section + ".JPG";

        tooltip.html('<h3>River = ' + riverLabel[d.riverFull] + ", Section = " + d.section + '</h3><br><img class="object-fit-contain" src= ' + fileName + '>')
           .style("left", "80px")// (d3.event.pageX + 15) + "px")
           .style("top",  "200px")// (d3.event.pageY - 15) + "px")
           .transition()
           .duration(100)
           .style("opacity", 1);
      })
      .on("mouseout", function (d) {
        d3.select(this)
          .attr("r", 4)
          .style("stroke", function(d) { return d3.rgb(riverColors(d.river)).darker(1); })
          .style("fill", function(d) { return riverColors(d.river); });

         tooltip.transition()
           .duration(250)
           .style("opacity", 0);
      });

  mapStanley.on("viewreset", onViewResetStanley)
  onViewResetStanley();

  function onViewResetStanley() {
    featureStanley.attr("transform", function(d) {
      return "translate(" + mapStanley.latLngToLayerPoint(d.LatLng).x + "," +
                            mapStanley.latLngToLayerPoint(d.LatLng).y + ")";
    });
  }

});


</script>

</body>
</html>